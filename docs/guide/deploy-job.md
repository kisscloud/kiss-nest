# 添加部署任务

项目在部署之前，需要创建部署任务。

## 1. 选择需要部署的项目

采用下拉选的方式选择项目，下拉选列表展示的是有构建任务的项目的名称。

## 2. 选择部署环境

采用下拉选的方式选择部署环境，下拉选列表展示的是环境的名称。部署环境需要在运行环境中配置。

## 3. 选择部署机器

从机器列表栏选择机器，点击分配，将机器添加到部署机器栏。机器列表中的机器需要先在服务器中配置，再将其添加到相应的部署环境中去。

## 4. 部署脚本

这里有预先设置的部署脚本。`git clone __CONFIG__ `这一行是添加配置文件的，默认配置文件的位置已有注释说明。如果需要修改配置文件的位置，需要修改这一行。获取配置文件的方式可以使用`git clone`或者`wget`或者其他方式。

其他的配置项不建议修改，很多都是系统预设的，随意修改可能会导致任务创建失败。不要使用自定义的`__CONFIG__`（除了默认配置文件位置），不然会被系统修改为其他值。

## 5. 启动配置

这里预设的启动配置是supervisor的脚本。所有的部署任务都会交给supervisor启动，服务器必须安装supervisor,不然在项目部署时会出错。supervisor的配置文件必须放在/etc/supervisor/下。

启动配置需要注意以下三个部分：

### 5.1 程序启动命令

`command =` 这一行需要自己填写的。这一行命令是用来启动项目的，所以填写的命令中需要包含启动的包名（全路径），配置文件名称（全路径）。

如果不知道部署的包的名称，可用可用`__PACKAGE__` 代替。如果没有修改配置文件的包路径，这里配置文件的包路径可用`__CONFIG__`代替，但是配置文件的名称需要自己填写。

如java项目：
```
command = /bin/java -jar -Dspring.config.location=__CONFIG__/kiss-nest.properties __PACKAGE__
```
这里`/bin/java -jar`是java启动jar包的命令，`-Dspring.config.location=`是指定外部的配置文件。`kiss-nest.properties`需要自己填写。

### 5.2 程序启动路径
`directory = ...` 如果在部署脚本中修改了包的路径，需要同步修改这一行。

### 5.3 日志输出文件

`stdout_logfile = ...` 项目的日志默认在这一行指定。如果想要修改，一定要确保指定的目录在服务器上存在，如果不存在，supervisor加载会报错。

ps:请按要求填写，不然部署项目时会出错。
